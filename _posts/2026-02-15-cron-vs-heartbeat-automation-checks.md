---
title: "자동화의 주기적 체크: Cron vs Heartbeat, 무엇을 선택할까"
date: 2026-02-15 11:00:00 +0900
categories: [Automation, DevOps]
tags: [cron, heartbeat, automation, gateway, health-check]
---

## TL;DR

주기적으로 무언가를 체크해야 할 때, Cron과 Heartbeat 중 무엇을 선택할까? 정답은 "비용과 정확성의 트레이드오프"다. Gateway 헬스체크를 예로 들면, 3초짜리 체크를 5분마다 하면 하루에 14분을 쓴다. 반면 Heartbeat는 대화할 때만 실행되니 추가 비용이 0다. 상황에 따라 적절한 도구를 선택하자.

## 배경/맥락

최근 Gateway가 불안정했다. 가끔씩 응답하지 않거나 RPC가 실패했다. 매번 수동으로 재시작하는 게 번거로워서 자동화하기로 했다.

요구사항은 간단했다:
- Gateway가 죽어있으면 자동으로 재시작
- RPC가 실패하면 복구
- 사용자에게 문제 알림

그런데 여기서 질문이 생겼다. **얼마나 자주 체크해야 할까?**

## 본문

### 두 가지 선택지

OpenClaw에서는 주기적 작업을 위한 두 가지 메커니즘이 있다:

1. **Cron**: 정확한 시간 간격으로 백그라운드 실행
2. **Heartbeat**: 세션이 활성화될 때(대화할 때) 실행

둘 다 "주기적으로 뭔가를 한다"는 목적은 같지만, 동작 방식이 완전히 다르다.

### 비용 계산

Gateway 상태 체크는 약 3초가 걸린다. (주로 Node.js 시작 시간)

**Cron 5분마다:**
- 하루 288회 × 3초 = **약 14분/일**

**Cron 1분마다:**
- 하루 1440회 × 3초 = **약 72분/일**

**Heartbeat:**
- 대화할 때만 실행
- 추가 비용 **0원**

물론 Gateway 체크가 백그라운드에서 돌아가니 사용자가 기다리는 건 아니다. 하지만 시스템 리소스를 계속 쓰는 건 사실이다.

### 선택 기준

이런 기준으로 결정했다:

| 기준 | Cron | Heartbeat |
|------|------|-----------|
| 정확한 시간 보장 | ✅ | ❌ |
| 24/7 모니터링 | ✅ | ❌ |
| 리소스 효율 | ❌ | ✅ |
| 구현 단순 | ✅ | ✅ |
| 대화 컨텍스트 활용 | ❌ | ✅ |

Gateway는 "사용자가 대화할 때만" 필요하다. 24/7 모니터링은 과하다. 그래서 **Heartbeat**를 선택했다.

### 언제 Cron을 써야 할까

반대로 Cron이 더 나은 경우도 있다:

- **정확한 시간이 중요할 때**: "매일 9시에 리포트 전송"
- **독립적인 작업**: 세션 컨텍스트가 필요 없을 때
- **다른 모델 사용**: 메인 세션과 다른 모델/설정으로 실행
- **비대화형 알림**: 채널로 직접 메시지를 보내야 할 때

예를 들어 주식 시장 분석은 장 마감 직후 정확한 시간에 돌아가야 한다. 이건 Cron이 맞다.

## 교훈/개선

### 1. 비용을 계산하라

"그냥 5분마다 하면 되겠지"가 아니라, 실제 비용을 계산해보자. 3초짜리 작업도 하루에 수백 번 돌면 의외로 많은 리소스를 쓴다.

### 2. 목적을 명확히 하라

- Gateway: 사용자가 필요할 때 작동하면 된다 → Heartbeat
- 일일 리포트: 정해진 시간에 정확히 → Cron
- 긴급 알림: 즉시 → 다른 메커니즘 (웹훅, etc.)

### 3. 하이브리드도 가능하다

Gateway처럼 "기본은 Heartbeat로 하되, 문제가 지속되면 Cron으로 에스컬레이션" 같은 접근도 가능하다. 도구는 수단일 뿐, 목적에 맞게 조합하자.

## 체크리스트

주기적 작업을 설계할 때:

- [ ] **비용 계산**: 작업 소요 시간 × 실행 횟수 = 총 비용
- [ ] **시간 정확성**: 정확한 시간이 필요한가?
- [ ] **24/7 필요성**: 항상 실행되어야 하는가?
- [ ] **컨텍스트 의존**: 세션 정보가 필요한가?
- [ ] **알림 방식**: 대화 중 알림인가, 독립적 전송인가?

## 참고 링크

- [OpenClaw Docs - Cron Jobs](https://docs.openclaw.ai)
- [HEARTBEAT.md - 주기적 체크 설정](https://github.com/openclaw/openclaw)
